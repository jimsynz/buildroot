# U-Boot configuration fragment for Arduino UNO Q
# Enables USB mass storage mode for fwup/Nerves deployment

# USB Support
CONFIG_USB=y
CONFIG_USB_XHCI_HCD=y
CONFIG_USB_DWC3=y
CONFIG_USB_DWC3_GENERIC=y

# USB Gadget Support (for USB mass storage mode)
CONFIG_USB_GADGET=y
CONFIG_USB_GADGET_DOWNLOAD=y
CONFIG_USB_GADGET_VENDOR_NUM=0x18d1
CONFIG_USB_GADGET_PRODUCT_NUM=0x4ee0
CONFIG_USB_GADGET_MANUFACTURER="Arduino"
CONFIG_USB_FUNCTION_MASS_STORAGE=y

# USB Mass Storage Command
CONFIG_CMD_USB=y
CONFIG_CMD_USB_MASS_STORAGE=y

# Fastboot Support (for initial flashing)
CONFIG_USB_FUNCTION_FASTBOOT=y
CONFIG_CMD_FASTBOOT=y
CONFIG_FASTBOOT=y
CONFIG_FASTBOOT_FLASH=y
CONFIG_FASTBOOT_FLASH_MMC=y
CONFIG_FASTBOOT_MMC_BOOT_SUPPORT=y
CONFIG_FASTBOOT_BUF_ADDR=0x91000000
CONFIG_FASTBOOT_BUF_SIZE=0x10000000
CONFIG_FASTBOOT_FLASH_MMC_DEV=0

# MMC/eMMC Support
CONFIG_MMC=y
CONFIG_DM_MMC=y
CONFIG_MMC_SDHCI=y
CONFIG_MMC_SDHCI_ADMA=y

# Storage Commands
CONFIG_CMD_MMC=y
CONFIG_CMD_GPT=y
CONFIG_CMD_PART=y
CONFIG_PARTITION_TYPE_GUID=y

# Environment in eMMC
CONFIG_ENV_IS_IN_MMC=y
CONFIG_SYS_MMC_ENV_DEV=0
CONFIG_ENV_OFFSET=0x400000
CONFIG_ENV_SIZE=0x10000

# Network support (optional, for network boot)
CONFIG_CMD_NET=y
CONFIG_CMD_DHCP=y
CONFIG_CMD_PING=y

# Device Tree Support
CONFIG_OF_CONTROL=y
CONFIG_OF_SEPARATE=y

# EFI Support (for potential dual-boot scenarios)
CONFIG_EFI_LOADER=y
CONFIG_CMD_BOOTEFI=y
# CONFIG_TOOLS_MKEFICAPSULE is not set

# Boot commands
CONFIG_CMD_BOOTMENU=y
CONFIG_AUTOBOOT=y
CONFIG_AUTOBOOT_KEYED=y
CONFIG_AUTOBOOT_PROMPT="Press SPACE to enter U-Boot console...\n"
CONFIG_AUTOBOOT_DELAY_STR=" "
CONFIG_AUTOBOOT_STOP_STR=" "
CONFIG_BOOTDELAY=3
CONFIG_USE_BOOTCOMMAND=y
CONFIG_BOOTCOMMAND="load mmc 0:0x43 ${scriptaddr} boot.scr && source ${scriptaddr}; echo Boot script not found, dropping to console"

# Misc useful commands
CONFIG_CMD_EXT4=y
CONFIG_CMD_EXT4_WRITE=y
CONFIG_CMD_FAT=y
CONFIG_CMD_FS_GENERIC=y
